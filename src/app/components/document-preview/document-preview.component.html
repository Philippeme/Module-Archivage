<div class="document-preview-overlay" *ngIf="document">
    <div class="document-preview-container">
        <div class="document-preview-header">
            <h5 class="mb-0">
                {{ selectedVersion?.originalName }}
                <ng-container *ngIf="selectedVersion as version">
                    <span class="badge bg-secondary ms-2" *ngIf="version.version > 1">v{{ version.version }}</span>
                </ng-container>
            </h5>
            <div class="document-preview-actions">
                <button class="btn btn-sm btn-outline-primary" (click)="downloadCurrentDocument()">
                    <i class="bi bi-download"></i> Télécharger
                </button>
                <button class="btn btn-sm btn-outline-success ms-2" (click)="shareCurrentDocument()">
                    <i class="bi bi-share"></i> Partager
                </button>
                <button class="btn btn-sm btn-outline-secondary ms-2" (click)="closePreview()">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
        </div>

        <div class="document-preview-content">
            <div class="document-sidebar">
                <div class="document-metadata">
                    <h6>Informations</h6>
                    <dl class="row mb-0">
                        <dt class="col-sm-5">Type</dt>
                        <dd class="col-sm-7">{{ selectedVersion?.type }}</dd>

                        <dt class="col-sm-5">Date de création</dt>
                        <dd class="col-sm-7">{{ selectedVersion?.creationDate | date:'dd/MM/yyyy' }}</dd>

                        <dt class="col-sm-5">Dernière modification</dt>
                        <dd class="col-sm-7">{{ selectedVersion?.lastModificationDate | date:'dd/MM/yyyy' }}</dd>

                        <dt class="col-sm-5">Source</dt>
                        <dd class="col-sm-7">{{ selectedVersion?.sourceInstitution }}</dd>

                        <dt class="col-sm-5">Concerné</dt>
                        <dd class="col-sm-7">
                            {{ selectedVersion?.concernedPerson1 }}
                            <ng-container *ngIf="selectedVersion?.concernedPerson2">
                                <br>{{ selectedVersion?.concernedPerson2 }}
                            </ng-container>
                        </dd>

                        <dt class="col-sm-5">Taille</dt>
                        <dd class="col-sm-7">{{ selectedVersion?.size | number }} Ko</dd>
                    </dl>
                </div>

                <div class="document-versions" *ngIf="documentVersions.length > 1">
                    <h6>Versions</h6>
                    <ul class="list-group">
                        <li *ngFor="let version of documentVersions"
                            class="list-group-item d-flex justify-content-between align-items-center"
                            [class.active]="version.id === selectedVersion?.id" (click)="selectVersion(version)">
                            Version {{ version.version }}
                            <span class="badge bg-primary rounded-pill">
                                {{ version.lastModificationDate | date:'dd/MM/yyyy' }}
                            </span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="document-viewer">
                <div class="spinner-container" *ngIf="isLoading">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Chargement...</span>
                    </div>
                </div>

                <div class="error-container" *ngIf="errorMessage">
                    <div class="alert alert-danger">
                        {{ errorMessage }}
                    </div>
                </div>

                <iframe *ngIf="pdfUrl && !isLoading && !errorMessage" [src]="pdfUrl" frameborder="0" width="100%"
                    height="100%">
                </iframe>
            </div>
        </div>
    </div>
</div>