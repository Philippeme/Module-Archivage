<div class="archive-container">
    <!-- Menu latéral -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h3>Archives</h3>
        </div>

        <!-- Basculer entre arborescence et accès rapide -->
        <div class="sidebar-tabs">
            <ul class="nav nav-pills nav-fill">
                <li class="nav-item">
                    <a class="nav-link" [class.active]="sidebarMode === 'tree'" (click)="setSidebarMode('tree')">
                        <i class="bi bi-folder2-open me-1"></i> Navigation
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" [class.active]="sidebarMode === 'quick'" (click)="setSidebarMode('quick')">
                        <i class="bi bi-lightning-charge me-1"></i> Accès rapide
                    </a>
                </li>
            </ul>
        </div>

        <!-- Arborescence des dossiers -->
        <div [hidden]="sidebarMode !== 'tree'" class="sidebar-content">
            <app-folder-tree [navigationMode]="navigationMode" [currentPath]="currentPath"
                (folderSelected)="openFolder($event)">
            </app-folder-tree>
        </div>

        <!-- Accès rapide (favoris et récents) -->
        <div [hidden]="sidebarMode !== 'quick'" class="sidebar-content">
            <app-quick-access (documentSelected)="openDocument($event)"></app-quick-access>
        </div>
    </div>

    <!-- Zone principale -->
    <div class="main-content">
        <!-- Barre de recherche -->
        <div class="search-container">
            <app-search-bar (search)="onSearch($event)"></app-search-bar>
        </div>

        <!-- Barre d'outils -->
        <div class="toolbar">
            <div class="navigation-controls">
                <button class="btn btn-sm btn-outline-secondary" [disabled]="!canNavigateBack()"
                    (click)="navigateBack()">
                    <i class="bi bi-arrow-left"></i>
                </button>
                <button class="btn btn-sm btn-outline-secondary ms-1" [disabled]="!canNavigateForward()"
                    (click)="navigateForward()">
                    <i class="bi bi-arrow-right"></i>
                </button>
            </div>

            <div class="view-controls ms-3">
                <button class="btn btn-sm" [class.active]="viewMode === 'list'" (click)="setViewMode('list')">
                    <i class="bi bi-list"></i> Liste
                </button>
                <button class="btn btn-sm" [class.active]="viewMode === 'grid'" (click)="setViewMode('grid')">
                    <i class="bi bi-grid"></i> Icônes
                </button>
            </div>

            <div class="organization-controls ms-3" *ngIf="currentPath !== '/Archives'">
                <div class="btn-group" role="group">
                    <button class="btn btn-sm" [class.active]="navigationMode === 'time'"
                        (click)="setNavigationMode('time')">
                        <i class="bi bi-calendar3"></i> Par temps
                    </button>
                    <button class="btn btn-sm" [class.active]="navigationMode === 'location'"
                        (click)="setNavigationMode('location')">
                        <i class="bi bi-geo-alt"></i> Par lieu
                    </button>
                </div>
            </div>

            <!-- Bouton pour ouvrir plusieurs onglets -->
            <div class="btn-group ms-3">
                <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown"
                    aria-expanded="false">
                    <i class="bi bi-window-plus"></i> Onglets
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" (click)="openMultipleTabsForFolders(currentFolders)">Ouvrir tous les
                            dossiers actuels</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li *ngFor="let segment of breadcrumbSegments">
                        <a class="dropdown-item" (click)="openInNewTab({name: segment.name, path: segment.path})">
                            {{ segment.name }}
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Contrôles de navigation géographique -->
        <div class="location-controls ms-3" *ngIf="navigationMode === 'location' && currentPath !== '/Archives'">
            <div class="row">
                <div class="col-md-4 mb-2">
                    <select class="form-select form-select-sm" [ngModel]="selectedRegion?.id"
                        (ngModelChange)="onRegionChange($event)">
                        <option [ngValue]="null">Sélectionner une région</option>
                        <option *ngFor="let region of availableRegions" [ngValue]="region.id">{{ region.nom }}</option>
                    </select>
                </div>
                <div class="col-md-4 mb-2">
                    <select class="form-select form-select-sm" [disabled]="!selectedRegion"
                        [ngModel]="selectedCercle?.id" (ngModelChange)="onCercleChange($event)">
                        <option [ngValue]="null">Sélectionner un cercle</option>
                        <option *ngFor="let cercle of availableCercles" [ngValue]="cercle.id">{{ cercle.nom }}</option>
                    </select>
                </div>
                <div class="col-md-4 mb-2">
                    <select class="form-select form-select-sm" [disabled]="!selectedCercle"
                        [ngModel]="selectedCommune?.id" (ngModelChange)="onCommuneChange($event)">
                        <option [ngValue]="null">Sélectionner une commune</option>
                        <option *ngFor="let commune of availableCommunes" [ngValue]="commune.id">{{ commune.nom }}
                        </option>
                    </select>
                </div>

                <div class="col-md-4 mb-2"
                    *ngIf="selectedCommune && selectedCercle && currentPath.includes('Centre d\'état civil')">
                    <select class="form-select form-select-sm" [disabled]="!selectedCommune"
                        [ngModel]="selectedCentre?.id" (ngModelChange)="onCentreChange($event, 'etatCivil')">
                        <option [ngValue]="null">Sélectionner un centre d'état civil</option>
                        <option *ngFor="let centre of availableCentresEtatCivil" [ngValue]="centre.id">{{ centre.nom }}
                        </option>
                    </select>
                </div>

                <div class="col-md-4 mb-2"
                    *ngIf="selectedCommune && selectedCercle && currentPath.includes('Centre de déclaration')">
                    <select class="form-select form-select-sm" [disabled]="!selectedCommune"
                        [ngModel]="selectedCentre?.id" (ngModelChange)="onCentreChange($event, 'declaration')">
                        <option [ngValue]="null">Sélectionner un centre de déclaration</option>
                        <option *ngFor="let centre of availableCentresDeclaration" [ngValue]="centre.id">{{ centre.nom
                            }}</option>
                    </select>
                </div>

                <div class="col-md-4 mb-2"
                    *ngIf="selectedCommune && selectedCercle && currentPath.includes('Tribunal')">
                    <select class="form-select form-select-sm" [disabled]="!selectedCommune"
                        [ngModel]="selectedTribunal?.id" (ngModelChange)="onTribunalChange($event)">
                        <option [ngValue]="null">Sélectionner un tribunal</option>
                        <option *ngFor="let tribunal of availableTribunaux" [ngValue]="tribunal.id">{{ tribunal.nom }}
                        </option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Filtres avancés -->
        <app-advanced-filter (filtersChanged)="applyFilters($event)"></app-advanced-filter>

        <!-- Chemin de navigation (breadcrumb) -->
        <div class="breadcrumb-container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li *ngFor="let segment of breadcrumbSegments; let isLast = last" class="breadcrumb-item"
                        [class.active]="isLast">
                        <a *ngIf="!isLast" href="#" (click)="navigateToBreadcrumb(segment, $event)">{{ segment.name
                            }}</a>
                        <span *ngIf="isLast">{{ segment.name }}</span>
                    </li>
                </ol>
            </nav>
        </div>

        <!-- Alerte d'erreur -->
        <div class="alert alert-danger m-3" *ngIf="errorMessage">
            {{ errorMessage }}
        </div>

        <!-- Indicateur de chargement -->
        <div class="loading-container" *ngIf="isLoading">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Chargement...</span>
            </div>
        </div>

        <!-- Mode recherche -->
        <div class="content-container" *ngIf="!isLoading && isSearchMode">
            <div class="search-results">
                <div class="search-header">
                    <h4>Résultats de recherche pour "{{ searchTerm }}"</h4>
                    <p>{{ currentDocuments.length }} document(s) trouvé(s)</p>
                </div>

                <app-document-list *ngIf="viewMode === 'list'" [documents]="currentDocuments"
                    (documentSelected)="openDocument($event)">
                </app-document-list>

                <app-document-grid *ngIf="viewMode === 'grid'" [documents]="currentDocuments"
                    (documentSelected)="openDocument($event)">
                </app-document-grid>

                <div class="empty-state" *ngIf="currentDocuments.length === 0">
                    <i class="bi bi-search display-1 text-muted"></i>
                    <p class="mt-3">Aucun résultat pour cette recherche</p>
                    <p class="text-muted">Essayez d'autres termes de recherche ou ajustez les filtres</p>
                </div>
            </div>
        </div>

        <!-- Mode navigation -->
        <div class="content-container" *ngIf="!isLoading && !isSearchMode">
            <app-document-list *ngIf="viewMode === 'list'" [folders]="currentFolders" [documents]="currentDocuments"
                (folderSelected)="openFolder($event)" (folderContextMenu)="openInNewTab($event)"
                (documentSelected)="openDocument($event)">
            </app-document-list>

            <app-document-grid *ngIf="viewMode === 'grid'" [folders]="currentFolders" [documents]="currentDocuments"
                (folderSelected)="openFolder($event)" (folderContextMenu)="openInNewTab($event)"
                (documentSelected)="openDocument($event)">
            </app-document-grid>

            <div *ngIf="currentFolders.length === 0 && currentDocuments.length === 0 && currentPath === '/Archives'">
                <!-- Afficher les raccourcis si nous sommes à la racine et qu'il n'y a pas de contenu -->
                <app-shortcuts [navigationMode]="navigationMode" (folderSelected)="openFolder($event)"></app-shortcuts>
            </div>
            <div class="empty-state"
                *ngIf="currentFolders.length === 0 && currentDocuments.length === 0 && currentPath !== '/Archives'">
                <i class="bi bi-folder-x display-1 text-muted"></i>
                <p class="mt-3">Aucun élément à afficher dans ce dossier</p>
            </div>
        </div>

        <!-- Prévisualisation du document (modal) -->
        <app-document-preview *ngIf="selectedDocument" [document]="selectedDocument" (close)="closePreview()">
        </app-document-preview>
    </div>
</div>